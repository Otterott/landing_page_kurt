<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Interactive Water Ripples – purple caustics</title>

  <style>
    html,body{height:100%;margin:0;overflow:hidden;}

    /* 水波容器 */
    #water-container{
      width:100%;
      height:100%;
      background:radial-gradient(circle at 50% 50%,
                  rgba(200,150,255,.25) 0%,
                  rgba(200,150,255,0)   70%);
      cursor:auto;                 /* ← 把 crosshair 改回默认 */
    }
    /* ripples 插件动态插入的 <canvas class="js-ripples"> */
    #water-container .js-ripples{
      cursor:auto !important;      /* ← 压过内联 style="cursor:crosshair" */
    }
  </style>
</head>

<body>
  <div id="water-container"></div>

  <!-- jQuery -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  <!-- 原版 jquery.ripples -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.ripples/0.5.3/jquery.ripples.min.js"></script>

  <!-- 着色器补丁：把白色高光染成淡紫 -->
  <script>
  (function ($) {
    if (!$.fn.ripples) return;
    const orig = $.fn.ripples.prototype._createShader;

    $.fn.ripples.prototype._createShader = function (type, src) {
      const gl = this._gl || (this.context && this.context.gl);
      const isFrag = type === (gl ? gl.FRAGMENT_SHADER : 35632);

      if (isFrag) {
        /* 把 vec3(1.0) 改成淡紫并整体再乘一层 tint */
        src = src.replace(/vec3\s*\(\s*1\.0\s*\)/g,
                          'vec3(0.78,0.59,1.0)')
                 .replace(/gl_FragColor\.rgb\s*=\s*(.*?);/,
                          'gl_FragColor.rgb = ($1) * vec3(0.88,0.70,1.00);');
      }
      return orig.call(this, type, src);
    };
  })(jQuery);
  </script>

  <!-- 初始化水波 -->
  <script>
  (function(){
    const $water = $('#water-container');

    $water.ripples({
      resolution : 512,
      dropRadius : 20,
      perturbance: 0.04,
      interactive: true
    });

    // 手动注水
    $water.on('mousemove touchmove', function (e){
      const t = e.originalEvent.touches;
      const x = t ? t[0].pageX : e.pageX;
      const y = t ? t[0].pageY : e.pageY;
      const off = $water.offset();
      $water.ripples('drop', x - off.left, y - off.top,
                     10, 0.04 + Math.random()*0.04);
    });

    // 视口变化时同步
    $(window).on('resize', ()=>{ try{ $water.ripples('updateSize'); }catch(e){} });
  })();
  </script>
</body>
</html>
